<!-- Coded for PS3™ Pro by Luan Teles -->
<html>
<head>
     <title>PlayStation&trade; Network Database</title>
</head>
<script>
    javascript:window.resizeTo(screen.width,screen.height)
</script>
<style>
	html, body {
		margin: 0;
		padding: 0;
		height: 100%;
		background: url("../resources/media/background.png") no-repeat center center fixed;
		background-size: cover;
		color: #fff;
		font-family: Arial, sans-serif;
		text-align: center;
	}
	
	header {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		height: 130px;
		padding: 10px 15px;
		background: rgba(0, 0, 0, 0.6);
		text-align: center;
		font-size: 12px;
		font-weight: bold;
		border-bottom: 2px solid #888;
		display: block;
		z-index: 2;
	}
	
	header a {
		font-size: 3em;
		color: #ffffff;
		text-decoration: none;
		font-weight: bold;
		display: block;
	}
	
	header a:hover {
		color: #66ccff;
	}
	#selection-menu {
		position: fixed;
		top: 128px; /* justo em cima da borda superior da sidebar */
		left: 0;
		right: 0;
		height: 28px;
		background: rgba(0,0,0,0.0); /* transparente para não alterar o visual */
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 20px;
		z-index: 6;
		font-size: 1em;
	}

	#selection-menu a {
		color: #fff;
		text-decoration: none;
		font-weight: bold;
		margin-left: 15px;
		margin-right: 15px;
	}

	#selection-menu a:hover { color: #66ccff; }
	
	form {
		margin: 10px auto;
	}
	
	input[type="search"],
	input[type="submit"],
	input[type="button"] {
		font-size: 1.2em;
		padding: 6px 10px;
		background: rgba(0, 0, 0, 0.6);
		border: 1px solid #aaa;
		border-radius: 5px;
	}
	
	input[type="submit"],
	input[type="button"] {
		color: #fff;
	}
	
	input[type="search"] {
		width: 250px;
		color: #00008B;
	}
	
	button {
		margin: 2px;
		background: rgba(0, 0, 0, 0.6);
		border: 1px solid #aaa;
		color: #fff;
		border-radius: 4px;
		font-size: 1em;
		padding: 3px 6px;
	}
	
	button:hover {
		background: rgba(255, 255, 255, 0.1);
	}
	
	#main.table {
		display: table;
		width: 100%;
		height: 100%;
		table-layout: fixed;
	}
	
	.table-cell {
		display: table-cell;
		vertical-align: top;
	}
	
	.sidebar {
		position: fixed;
		top: 150px;
		bottom: 0;
		left: 0;
		width: 80px;
		height: 100vh;
		background: rgba(0, 0, 0, 0.6);
		padding: 0 5px 5px 5px;
		box-sizing: border-box;
		border-right: 2px solid #888;
		z-index: 3;
	}
	
	.sidebar-top-border {
		position: fixed;
		top: 152px;
		bottom: 0;
		left: 5px;
		width: 90px;
		height: 2px;
		background: rgba(0, 8, 30, 1);
		margin-top: -2px;
		margin-left: -7px;
		z-index: 4;
	}

    .sidebar-right {
        position: fixed;
        top: 150px;
        bottom: 0;
        right: 0;
        width: 80px;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        padding: 0 5px 5px 5px;
        box-sizing: border-box;
        border-left: 2px solid #888;
        z-index: 3;
    }

    .sidebar-right-top-border {
        position: fixed;
        top: 152px;
        right: 5px;
        width: 90px;
        height: 2px;
        background: rgba(0, 8, 30, 1);
        margin-top: -2px;
        margin-right: -7px;
        z-index: 4;
    }

    .sidebar ul, .sidebar-right ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .sidebar ul li, .sidebar-right ul li {
        margin: 5px 0;
    }

    .sidebar ul li a, .sidebar-right ul li a {
        text-decoration: underline;
        display: block;
        color: #ffffff;
    }

    .sidebar ul li a:hover, .sidebar-right ul li a:hover {
        color: #ffff00;
    }

    .sidebar ul li a:active, .sidebar-right ul li a:active {
        color: #0000ff;
    }
	
	.sidebar-heading-left {
		color: #FFFFFF;
		font-weight: bold;
		font-size: 1.3em;
		margin-top: 15px;
		text-align: center;
	}
	
	.sidebar-heading-right {
		color: #FFFFFF;
		font-weight: bold;
		font-size: 1.3em;
		margin-top: 35px;
		text-align: center;
	}
	
    #letters {
        margin-top: 10px;
    }

    #letters a {
        width: 100%;
        text-align: center;
        margin: 2px 0;
        display: block;
        color: #ffffff;
    }
	
	#letters a.active, #region-links a.active {
        color: #66ccff;
        text-decoration: underline;
		font-weight: bold;
    }

    #license-links {
        margin-top: 20px;
    }
	
	#region-links {
        margin-top: 10px;
    }
	
	#region-links a {
        width: 100%;
        text-align: center;
        margin: 2px 0;
        display: block;
        color: #ffffff;
    }

    #license-links a {
        width: 100%;
        text-align: center;
        margin: 2px 0;
        display: block;
        color: #ffffff;
    }

    .content {
        padding-right: 0px;
        text-align: center;
    }

    ul#list {
		position: relative;
		top: 170px;
		width: auto;
		max-width: 800px;
		list-style: none;
		padding: 10px 20px;
		margin: 0 auto;
		display: inline-block;
		text-align: left;
		font-size: 1em;
		background: rgba(0, 0, 0, 0.5);
		border-radius: 10px;
		white-space: normal;  /* nowrap */
		min-width: 400px;
		z-index: 1;
	}

    ul#list li {
        padding: 8px 10px;
        border-bottom: 1px solid #333;
    }

    ul#list li a {
        text-decoration: none;
        color: #fff;
    }

    ul#list li a:hover {
        text-decoration: underline;
        color: #66ccff;
    }

    [download] {
        background: #fff;
        color: #000 !important;
        padding: 2px 6px;
        margin-left: 10px;
        text-decoration: none;
        border-radius: 3px;
        font-size: 0.9em;
	}
	
	#icon {
		width: 64px;
		height: auto;
		margin: 10px auto;
	}
	
	::-webkit-scrollbar {
		width: 8px;
	}
	
	::-webkit-scrollbar-track {
		background: transparent;
	}
	
	::-webkit-scrollbar-thumb {
		background: #aaa;
	}
	
	#backToTop {
		position: fixed;
		bottom: 20px;
		right: 110px;
		padding: 10px 16px;
		background: rgba(0, 0, 0, 0.7);
		color: white;
		font-weight: bold;
		border: 2px solid #888;
		border-radius: 8px;
		cursor: pointer;
		z-index: 15;
	}
	
	#backToTop:hover {
		background: rgba(255, 255, 255, 0.1);
	}
	
	#selection-menu a.active {
    color: #66ccff;
    text-decoration: underline;
	}
</style>

<body>
    <header>
        <a href="">PlayStation&trade; Network Database</a>
        <div id="count" aria-live="polite" role="status">Loading</div>
		<form name="engine" onsubmit="setFilter('search', this.query.value, null); return false;">
            <input type="search" name="query" size="25" placeholder="Search">
            <input type="submit" name="send" value="Search" disabled>
			<input type="button" id="license-link-rainbow" value="License Pack" onclick="window.location.href='https://github.com/PS3-Pro/License-Files/releases/download/Licenses/License_Pack_Bin.pkg'">
            <input type="button" name="fetch" value="Reload DB" onclick="fetchDB()">
		</form>
    </header>

	<div id="selection-menu" aria-hidden="false">
        <a href="#" id="ln-avatar">Avatars</a>
        <a href="#" id="ln-demos">Demos</a>
        <a href="#" id="ln-dlcs">DLCs</a>
        <a href="#" id="ln-game">Games</a>
        <a href="#" id="ln-themes">Themes</a>
    </div>
    <div id="main" class="table">
        <div class="sidebar table-cell" id="sidebar">
			<div class="sidebar-top-border"></div>
  		              <div class="sidebar-heading-left">Filter</div>
  		      <ul id="letters"></ul>
  		  </div>

        <div class="content table-cell">
            <ul id="list"></ul>
        </div>

        <div class="sidebar-right" id="sidebar-right">
			<div class="sidebar-right-top-border"></div>
			
			<div class="sidebar-heading-right">Region</div>
			<br>
			
			<ul id="region-links">
				<li><a href="#" class="active" onclick="setFilter('region', 'ALL', this); return false;">All</a></li>
				<li><a href="#" onclick="setFilter('region', 'US', this); return false;">US</a></li>
				<li><a href="#" onclick="setFilter('region', 'EU', this); return false;">EU</a></li>
				<li><a href="#" onclick="setFilter('region', 'JP', this); return false;">JP</a></li>
				<li><a href="#" onclick="setFilter('region', 'ASIA', this); return false;">ASIA</a></li>
			</ul>
		</div>

    <button id="backToTop" onclick="scrollToTop()">&#8593; Top</button>

	<script>
function scrollToTop() {
    window.scrollTo(0, 0);
}

function sort(lines, algo) {
    for (var i = 0; i < lines.length; i++) {
        for (var j = 0; j < lines.length - i - 1; j++) {
            if (algo(lines[j], lines[j + 1])) {
                var temp = lines[j];
                lines[j] = lines[j + 1];
                lines[j + 1] = temp;
            }
        }
    }
    return lines;
}

try {
    var g_letterFilter = "";
    var g_regionFilter = "ALL";

    var f = document.forms.engine;

    var dbPath = "https://ps3-pro.github.io/PSN-Content/resources/database/games.tsv";

    var DB = window.localStorage ? JSON.parse(localStorage.DB || '[]') : [];

	function makeRap(row) {
		var hex = row[4];
		var contentID = row[5];
	
		if (!hex || hex == "NOT REQUIRED") {
			return "";
		}
	
		if (hex == "MISSING") {
			return '<span style="color: red;"> - Missing RAP</span>';
		}
		
		//return '<a download="' + row[1] + '-' + row[0] + '_00-' + hex + '.rap" href="http://yne.fr/psndl/' + hex + '.rap">RAP</a>';
		return '<a download="' + contentID + '.rap" href="https://ps3-pro.github.io/License-Files/files/' + contentID + '.rap">RAP</a>';
	}

    function fetchDB() {
        f.fetch.disabled = true;
        var xhr = new XMLHttpRequest();
        xhr.onabort = xhr.ontimeout = xhr.onerror = function () {
            alert("Error loading DB");
            f.fetch.disabled = false;
        };
        xhr.onload = function () {
            if (xhr.status != 200) {
                alert("Status " + xhr.status);
                f.fetch.disabled = false;
                return;
            }

            var lines = xhr.responseText.split("\n");
			DB = [];
			for (var i = 0; i < lines.length; i++) {
				DB.push(lines[i].split("\t"));
			}

            if (window.localStorage) {
                localStorage.DB = JSON.stringify(DB);
            }
            
            f.fetch.disabled = false;
            render();
        };
        xhr.open('GET', dbPath);
        xhr.send();
    }

    function render() {
		f.fetch.type = window.localStorage ? 'button' : 'hidden';
		f.send.disabled = DB.length == 0;
		f.query.placeholder = DB.length + " items found";
	
		// --- LÓGICA DE FILTRO COMBINADO ---
		
		// 1. Criar Regra de Região (baseado em g_regionFilter)
		var regionRule;
		if (g_regionFilter == "ALL" || g_regionFilter == "") {
			regionRule = new RegExp(".*"); // Match tudo
		} else {
			regionRule = new RegExp("^" + g_regionFilter + "$", 'i'); // Match exato (ex: /^US$/i)
		}

		// 2. Criar Regra de Letra/Busca (baseado em g_letterFilter)
		var letterRule;
		var isSearch = (g_letterFilter.length > 0 && g_letterFilter[0] != '^');
		
		if (g_letterFilter == "") {
			letterRule = new RegExp(".*"); // Match tudo
		} else if (isSearch) {
			letterRule = new RegExp(g_letterFilter, 'i'); // Regra de busca normal
		} else {
			letterRule = new RegExp(g_letterFilter, 'i'); // Regra de "Começa com" (ex: /^A/i)
		}

		// 3. Loop principal com FILTRO DUPLO
		var maxResults = isSearch ? 99 : 999;
		var matches = [];
		for (var i = 0; i < DB.length && matches.length < maxResults; i++) {
			var row = DB[i];
			if (!row[2]) continue; // Pula se não tiver nome

			// Variáveis de checagem
			var nameMatches = false;
			var regionMatches = false;

			// Checa Região (Coluna 1)
			if (g_regionFilter == "ALL" || (row[1] && regionRule.test(row[1]))) {
				regionMatches = true;
			}

			// Checa Letra/Busca (Coluna 2 ou 0)
			if (g_letterFilter == "") {
				nameMatches = true; // Se filtro de letra/busca está vazio, passa direto
			} else if (isSearch) {
				// Se é busca, checa Nome (Col 2) OU ID (Col 0)
				if ((row[2] && letterRule.test(row[2])) || row[0] == g_letterFilter) {
					nameMatches = true;
				}
			} else {
				// Se é filtro de letra (ex: ^A), checa SÓ o Nome (Col 2)
				if (row[2] && letterRule.test(row[2])) {
					nameMatches = true;
				}
			}

			// ADICIONA NA LISTA APENAS SE OS DOIS FILTROS BATEREM
			if (nameMatches && regionMatches) {
				matches.push(row);
			}
		}
		// --- FIM DA LÓGICA DE FILTRO ---
	
		sort(matches, function(a, b) { return a[2] > b[2]; });
	
		var html = "";
		for (var i = 0; i < matches.length; i++) {
			var a = matches[i];
			if (a[3] && a[3] !== "MISSING") {
				html += '<li><a href="' + a[3] + '">' + a[2] + ' [' + a[0] + "]</a> " + makeRap(a) + "</li>";
			}
		}
	
		if (html === "") {
			html = "<li>No items found.</li>";
		}
		
		document.getElementById('list').innerHTML = html;
		var regionText = (g_regionFilter == "ALL") ? "All Regions" : g_regionFilter;
		document.getElementById('count').textContent = "Displaying " + matches.length + " items | " + regionText;
	}
	
	function setFilter(type, value, clickedElement) {
		// 1. ATUALIZA AS VARIÁVEIS GLOBAIS
		if (type == 'letter') {
			g_letterFilter = value;
			f.query.value = ""; // Limpa a barra de busca
			
			// Remove 'active' de todas as outras letras
			var links = document.getElementById("letters").getElementsByTagName("a");
			for(var i=0; i<links.length; i++) { links[i].className = ""; }
	
		} else if (type == 'region') {
			g_regionFilter = value;
			
			// Remove 'active' de todas as outras regiões
			var links = document.getElementById("region-links").getElementsByTagName("a");
			for(var i=0; i<links.length; i++) { links[i].className = ""; }
	
		} else if (type == 'search') {
			g_letterFilter = value; // Busca sobrescreve o filtro de letra
			
			// Remove 'active' de todas as letras
			var links = document.getElementById("letters").getElementsByTagName("a");
			for(var i=0; i<links.length; i++) { links[i].className = ""; }
		}
		
		// 2. ADICIONA 'ACTIVE' NO LINK CLICADO
		if (clickedElement) {
			clickedElement.className = "active";
		}
		
		// 3. RODA O RENDER
		render();
	}

    function createLetterLinks() {
        var links = '<a href="#" onclick="setFilter(\'letter\', \'^[0-9]\', this); return false;">[0-9]</a>';
        for (var c = 65; c < 91; c++) {
            links += '<a href="#" onclick="setFilter(\'letter\', \'^\'+this.innerHTML, this); return false;">' + String.fromCharCode(c) + '</a>';
        }
        document.getElementById("letters").innerHTML = links;
    }

    createLetterLinks();

	function selectCategory(cat) {
		switch(cat) {
			case "games": dbPath = "https://ps3-pro.github.io/PSN-Content/resources/database/games.tsv"; break;
			case "avatars": dbPath = "https://ps3-pro.github.io/PSN-Content/resources//database/avatars.tsv"; break;
			case "demos": dbPath = "https://ps3-pro.github.io/PSN-Content/resources/database/demos.tsv"; break;
			case "dlcs": dbPath = "https://ps3-pro.github.io/PSN-Content/resources/database/dlcs.tsv"; break;
			case "themes": dbPath = "https://ps3-pro.github.io/PSN-Content/resources/database/themes.tsv"; break;
		}
	
		DB = [];
		if (window.localStorage) localStorage.DB = "[]"; 
	
		// --- RESETAR FILTROS AO MUDAR DE ABA ---
		g_letterFilter = ""; // Limpa filtro de letra/busca
		g_regionFilter = "ALL"; // Reseta para ALL
		f.query.value = ""; // Limpa texto da busca
		
		// Limpa destaques de letra da aba anterior
		var letterLinks = document.getElementById("letters").getElementsByTagName("a");
		for(var i=0; i<letterLinks.length; i++) { letterLinks[i].className = ""; }
		
		// Reseta destaques de região para "ALL"
		var regionLinks = document.getElementById("region-links").getElementsByTagName("a");
		for(var i=0; i<regionLinks.length; i++) { regionLinks[i].className = ""; }
		if(regionLinks[0]) regionLinks[0].className = "active"; // Ativa o "ALL"
		// --- FIM DO RESET ---

		var links = '<a href="#" onclick="setFilter(\'letter\', \'^[0-9]\', this); return false;">[0-9]</a>';
		for (var c = 65; c < 91; c++) {
			links += '<a href="#" onclick="setFilter(\'letter\', \'^\'+this.innerHTML, this); return false;">' + String.fromCharCode(c) + '</a>';
		}
		document.getElementById("letters").innerHTML = links;
	
		var menu = document.getElementById("selection-menu").getElementsByTagName("a");
		for (var i = 0; i < menu.length; i++) {
			menu[i].className = menu[i].className.replace("active", "");
		}
		var idMap = {games:"ln-game", avatars:"ln-avatar", demos:"ln-demos", dlcs:"ln-dlcs", themes:"ln-themes"};
		document.getElementById(idMap[cat]).className += " active";
	
		document.getElementById('list').innerHTML = '<li>Downloading database... Please wait.</li>';
		document.getElementById('count').textContent = "Loading...";
		
		fetchDB();
	}

        document.getElementById("ln-avatar").onclick = function(e) { e.preventDefault(); selectCategory("avatars"); };
        document.getElementById("ln-demos").onclick = function(e) { e.preventDefault(); selectCategory("demos"); };
        document.getElementById("ln-dlcs").onclick = function(e) { e.preventDefault(); selectCategory("dlcs"); };
        document.getElementById("ln-game").onclick = function(e) { e.preventDefault(); selectCategory("games"); };
        document.getElementById("ln-themes").onclick = function(e) { e.preventDefault(); selectCategory("themes"); };

        selectCategory("games");
		
		var isChrome = /Chrome/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent) && !/OPR/.test(navigator.userAgent);
		
		if (isChrome) {
			var warningMessage = [
				"Google Chrome blocks insecure downloads (HTTP links on an HTTPS page).",
				"",
				"For the download links to work, please use a different browser (like Microsoft Edge or Firefox)"
			].join("\n");

			alert(warningMessage);
		}
		
		try {
            var rainbowColors = ["#FF0000", "#FF7F00", "#FFFF00", "#00FF00", "#FFFFFF", "#9400D3"]; // Vermelho, Laranja, Amarelo, Verde, Azul, Roxo
            var rainbowIndex = 0;
            
            setInterval(function() {
                var link = document.getElementById("license-link-rainbow");
                if (link) {
                    link.style.color = rainbowColors[rainbowIndex];
                    
                    rainbowIndex++;
                    
                    if (rainbowIndex >= rainbowColors.length) {
                        rainbowIndex = 0;
                    }
                }
            }, 500); 
        } catch (e) {
        }
        
    } catch (a) {
        alert(a);
    }
</script>
    </body>
</html>